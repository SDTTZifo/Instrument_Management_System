{% extends 'base.html' %}

{% block content %}
<div class="container text-center mt-5">
    <h1>Dashboard</h1>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-4">
            <div class="tile text-center shadow-sm p-3" style="background-color: #f44336; color: white;">
                <div class="tile-header">
                    <i class="fa fa-microscope fa-3x"></i>
                    <h5 class="tile-title mt-3">Total Instruments</h5>
                </div>
                <p class="tile-count" id="totalInstruments">{{ instrument_count }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tile text-center shadow-sm p-3" style="background-color: #088da5; color: white;">
                <div class="tile-header">
                    <i class="fa fa-folder fa-3x"></i>
                    <h5 class="tile-title mt-3">Total Categories</h5>
                </div>
                <p class="tile-count" id="totalcategories">{{ category_count }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tile text-center shadow-sm p-3" style="background-color: #138d75; color: white;">
                <div class="tile-header">
                    <i class="fa fa-location-dot fa-3x"></i>
                    <h5 class="tile-title mt-3">Total Locations</h5>
                </div>
                <p class="tile-count" id="totallocations">{{ location_count }}</p>
            </div>
        </div>
    </div>
</div>

<br><br><br>

<div class="container">
    <div class="row">
        <!-- Upcoming Bookings Section (Left Half) -->
        <div class="col-md-6">
            <h2 class="mb-3">Upcoming Bookings</h2>
            {% if upcoming_booking %}
                <div class="row">
                    {% for booking in upcoming_booking %}
                    <div class="col-12 mb-4">
                        <div class="tile shadow-sm p-3 tile-color">
                            <div class="tile-header">
                                <h5 class="tile-title">{{ booking.details }}</h5>
                            </div>
                            <div class="tile-body d-flex justify-content-between align-items-center">
                                <span><strong>{{ booking.instrument }}</strong></span>
                                <span class="booking-date-time">
                                    <i class="fa fa-clock"></i> 
                                    <strong class="time">{{ booking.booking_start_date_time|date:'c' }}</strong>
                                </span>
                                <span class="booking-location">
                                    <i class="fa fa-map-marker-alt"></i> 
                                    <strong>{{ booking.location }}</strong>
                                </span>
                            </div>                
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info text-center" role="alert">
                    You have no upcoming bookings.
                </div>
            {% endif %}
        </div>

        <!-- Attention for Maintenance Section (Right Half) -->
        <div class="col-md-6">
            <h2 class="mb-3">Attention for Maintenance</h2>
            {% if instrument_owned %}
                <div class="row">
                    {% for owned in instrument_owned %}
                    <div class="col-12 mb-4">
                        <div class="tile shadow-sm p-3 tile-color">
                            <div class="tile-header">
                                <h5 class="tile-title">{{ owned.details }}</h5>
                            </div>
                            <div class="tile-body d-flex justify-content-between align-items-center">
                                <span><strong>{{ owned.instrument_name }}</strong></span>                    
                                <span><i class="fa fa-calendar"></i> <strong>{{ owned.maintenance_date|date:"D, M d, Y" }}</strong></span>
                            </div>                
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info text-center" role="alert">
                    You have no upcoming maintenance.
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    body {
        background-color: #f4f4f4;
    }
    .tile {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        transition: transform 0.2s ease-in-out;
    }
    .tile:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .tile-header {
        text-align: center;
    }
    .tile-title {
        margin-top: 10px;
        font-size: 1.25rem;
        font-weight: 500;
    }
    .tile-count {
        font-size: 2rem;
        font-weight: 700;
        margin-top: 10px;
    }
    .tile-color:nth-child(odd) {
        background-color: #e3f2fd;
    }
    .tile-color:nth-child(even) {
        background-color: #f1f8e9;
    }
    .booking-date-time, .booking-location {
        margin: 0 10px;
        color: #333;
    }
</style>

<!-- Include necessary scripts and styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    function convertUTCToLocal(utcDateTime) {
      const utcDate = new Date(utcDateTime);
      return utcDate.toLocaleString('en-IN', {
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: true,
      });
    }

    document.querySelectorAll('.time[data-utc]').forEach(function(element) {
      const utcDateTime = element.getAttribute('data-utc');
      const localDateTime = convertUTCToLocal(utcDateTime);
      element.innerText = localDateTime;
    });
  });
</script>
{% endblock %}
